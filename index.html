<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Movie Library</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="stylesheet" href="./style/home.css">
  <link rel="stylesheet" href="./style/style.css">
</head>
<body>

  <!-- Sidebar will go here -->
  <div id="sidebar-container"></div>

  <!-- Header -->
  <div class="header-container">
    <div class="header-background"></div>
    <div class="header-text">Lil Petey's Films+</div>
  </div>

  <div class="intro-box">
    <pre>Hello and Welcome to Lil Petey's Films+! Here you can watch all movies made by the studio for free and no ads included. Information on other projects will also drop here when new info has released.
  
  Have fun!
  -Lil Petey</pre>
  </div> 
  
  <!-- Coming Soon Section -->
  <div class="intro-box" style="width:30rem; font-size: 2rem; background:None;">
    <pre>COMING SOON!!!!</pre>
  </div> 

  <div class="gallery" id="coming-soon-gallery">
    <p style="color: gray;">Loading upcoming releases...</p>
  </div>

  <!-- Movies Section -->
  <div class="intro-box" style="width:30rem; font-size: 2rem; background:None;">
    <pre>Movies</pre>
  </div> 

  <!-- Movie Gallery -->
  <div class="gallery" id="movie-gallery">
    <p style="color: gray;">Loading movies...</p>
  </div>

  <!-- Sidebar Loader -->
  <script src="./sidebar.js"></script>
  <script>
    fetch('./sidebar.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('sidebar-container').innerHTML = html;
      })
      .then(() => {
        initSidebar();
      });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Helper to render movie cards
      const renderGallery = (movies, containerId, linkable = true) => {
        const gallery = document.getElementById(containerId);
        gallery.innerHTML = '';

        movies.forEach((movie, index) => {
          const card = document.createElement('div');
          card.className = 'movie-card';

          if (linkable) {
            card.onclick = () => {
              window.location.href = `./movie.html?movie=${index}`;
            };
          }

          const img = document.createElement('img');
          img.src = movie.thumbnail;
          img.alt = movie.title;

          const title = document.createElement('div');
          title.className = 'title';
          title.textContent = movie.title;

          card.appendChild(img);
          card.appendChild(title);
          gallery.appendChild(card);
        });
      };

      try {
        const [moviesRes, upcomingRes] = await Promise.all([
          fetch('./data/movie_data.json'),
          fetch('./data/comingsoon_data.json')
        ]);

        const movies = await moviesRes.json();
        const comingSoon = await upcomingRes.json();

        renderGallery(movies, 'movie-gallery', true);
        renderGallery(comingSoon, 'coming-soon-gallery', false);

      } catch (err) {
        console.error("Failed to load data:", err);
        document.getElementById('movie-gallery').innerHTML = `<p style="color: red;">Could not load movie list.</p>`;
        document.getElementById('coming-soon-gallery').innerHTML = `<p style="color: red;">Could not load upcoming movies.</p>`;
      }
    });
  </script>

</body>
</html>

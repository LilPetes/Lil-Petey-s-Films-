<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Episodes</title>
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <link rel="stylesheet" href="./style/style.css">
  <link rel="stylesheet" href="./style/episodes.css">
  <style>
    .header-background {
      background-image: url('https://thumbnail');
    }
  </style>
</head>
<body>

  <div class="header-container">
    <div class="header-background"></div>
    <div class="header-text">Season</div>
  </div>

  <div class="content-section">
    <img src="" alt="Image">
    <div class="content-text">
      <pre>This page does not exist</pre>
    </div>
  </div>

  <div id="episodes-list"></div>

  <div id="sidebar-container"></div>
  <script src="./sidebar.js"></script>
  <script>
    fetch('./sidebar.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('sidebar-container').innerHTML = html;
      })
      .then(() => {
        initSidebar();
      });
  </script>  

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      const params = new URLSearchParams(window.location.search);
      const seasonIndex = parseInt(params.get('season'), 10);
  
      if (isNaN(seasonIndex)) return;
  
      try {
        const response = await fetch('./data/episodes_data.json');
        const data = await response.json();
  
        const season = data[seasonIndex];
        if (!season) return;
  
        document.title = season.title;
  
        const headerBg = document.querySelector('.header-background');
        if (headerBg) {
          headerBg.style.backgroundImage = `url('${season.thumbnail}')`;
        }
  
        const headerText = document.querySelector('.header-text');
        if (headerText) {
          headerText.textContent = season.title;
        }
  
        const img = document.querySelector('.content-section img');
        if (img) {
          img.src = season.thumbnail;
          img.alt = season.title;
        }
  
        const desc = document.querySelector('.content-text pre');
        if (desc) {
          desc.textContent = season.description;
        }

        const episodesList = document.getElementById('episodes-list');
        episodesList.innerHTML = ''; 
  
        season.embed_links.forEach(episode => {
            const episodeElement = document.createElement('div');
            episodeElement.className = 'episode';

            const titleElement = document.createElement('h2');
            titleElement.textContent = episode.title;

            const descriptionElement = document.createElement('p');
            descriptionElement.textContent = episode.description;

            const iframeElement = document.createElement('iframe');
            iframeElement.src = episode.embed_link;
            iframeElement.width = "100%";
            iframeElement.height = "400";
            iframeElement.style.border = "none";
            iframeElement.allowFullscreen = true;

            episodeElement.appendChild(titleElement);
            episodeElement.appendChild(descriptionElement);
            episodeElement.appendChild(iframeElement);

            episodesList.appendChild(episodeElement);
        });

      } catch (err) {
        console.error("Failed to load or process season data:", err);
      }
    });
  </script>  

</body>
</html>